<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ¼¢å­—ãƒ‰ãƒªãƒ«ãƒ¡ãƒ¼ã‚«ãƒ¼</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Zen+Maru+Gothic:wght@400;700&display=swap" rel="stylesheet">
    <style>
        body { 
            font-family: 'Zen Maru Gothic', sans-serif; 
            background-color: #f0f4f8;
            color: #334155;
        }
        
        .print-page {
            width: 210mm;
            height: 296mm;
            padding: 15mm;
            margin: 20px auto;
            background: white;
            display: flex;
            flex-direction: column;
            box-shadow: 0 10px 25px rgba(0,0,0,0.05);
            box-sizing: border-box;
        }

        .print-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-end;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid #cbd5e1;
        }
        .header-date { width: 35%; font-size: 14px; font-weight: bold; color: #64748b; }
        .header-name { width: 45%; font-size: 14px; text-align: right; font-weight: bold; color: #64748b; }
        .underline-box {
            display: inline-block;
            border-bottom: 2px solid #cbd5e1;
            min-width: 35px;
            text-align: center;
        }

        .question-grid {
            display: grid;
            grid-template-columns: 1fr;
            grid-template-rows: repeat(10, 1fr);
            gap: 12px;
            flex-grow: 1;
        }

        .question-box {
            border: 2px solid #e2e8f0;
            border-radius: 12px;
            padding: 15px 15px 8px 15px; /* ä¸Šã«ä½™è£•ã‚’æŒãŸã›ã¦ãƒ«ãƒ“ã®æ¬ ã‘ã‚’é˜²æ­¢ */
            display: flex;
            align-items: center;
            gap: 15px;
            position: relative; /* ãƒ«ãƒ“ã®åŸºæº–ç‚¹ */
        }

        .img-preview-box {
            width: 80px;
            height: 60px;
            background-color: #f8fafc;
            border: 1px dashed #cbd5e1;
            border-radius: 8px;
            display: flex;
            justify-content: center;
            align-items: center;
            flex-shrink: 0;
        }
        .img-preview-box img { max-width: 100%; max-height: 100%; object-fit: contain; }

        .sentence-display {
            font-size: 1.4rem;
            line-height: 2.2; /* è¡Œé–“ã‚’åºƒã’ã¦ãƒ«ãƒ“ã®ã‚¹ãƒšãƒ¼ã‚¹ã‚’ç¢ºä¿ */
            display: flex;
            align-items: center;
            flex-wrap: wrap;
            flex-grow: 1;
        }

        .write-box {
            width: 55px; height: 55px;
            border: 2px solid #94a3b8;
            border-radius: 8px;
            position: relative;
            display: inline-flex;
            justify-content: center;
            align-items: center;
            margin: 5px 8px 0 8px; /* å°‘ã—ä½™ç™½ã‚’åºƒã’ãŸ */
            background: #fff;
        }
        /* ãƒã‚¹ã®ä¸­ã®åå­—ç·š */
        .write-box::before { content: ""; position: absolute; top: 50%; left: 0; right: 0; border-top: 1px dashed #e2e8f0; }
        .write-box::after { content: ""; position: absolute; left: 50%; top: 0; bottom: 0; border-left: 1px dashed #e2e8f0; }

        .ruby {
            position: absolute;
            top: -26px; /* å°‘ã—ä¸Šã«ãšã‚‰ã—ã¦è¦‹ã‚„ã™ã */
            left: 50%; transform: translateX(-50%);
            font-size: 0.85rem; 
            white-space: nowrap; 
            color: #334155;
            font-weight: bold;
        }

        .read-underline { border-bottom: 2px solid #334155; padding: 0 4px; font-weight: bold; }
        .read-ans-line { width: 120px; border-bottom: 1px solid #94a3b8; height: 24px; margin-left: auto; }

        @media print {
            .no-print { display: none !important; }
            body { background: white; margin: 0; padding: 0; }
            .print-page { margin: 0; border-radius: 0; box-shadow: none; page-break-after: always; }
        }

        .reorder-btn { display: flex; flex-direction: column; gap: 2px; }
        .reorder-btn button {
            padding: 2px 6px;
            background: #f1f5f9;
            border-radius: 4px;
            font-size: 10px;
            color: #94a3b8;
        }
        .reorder-btn button:disabled { opacity: 0.3; }
    </style>
</head>
<body class="pb-20">

    <div class="no-print max-w-5xl mx-auto p-6">
        <header class="flex flex-col md:flex-row justify-between items-start mb-6 gap-4">
            <div>
                <h1 class="text-3xl font-bold text-slate-700">ğŸ“ æ¼¢å­—ãƒ‰ãƒªãƒ«ãƒ¡ãƒ¼ã‚«ãƒ¼</h1>
                <p class="text-sm text-slate-500 mt-1">ã€Œ[ ]ã€ã§å›²ã£ãŸéƒ¨åˆ†ãŒå•é¡Œã«ãªã‚Šã¾ã™ã€‚â†‘â†“ã§é †ç•ªå¤‰æ›´ã€‚</p>
            </div>
            <div class="flex flex-wrap gap-2">
                <div class="flex bg-slate-200 p-1 rounded-xl">
                    <button onclick="setMode('write')" id="btn-write" class="px-4 py-2 rounded-lg text-sm font-bold bg-white shadow-sm text-sky-600">æ›¸ãã¨ã‚Š</button>
                    <button onclick="setMode('read')" id="btn-read" class="px-4 py-2 rounded-lg text-sm font-bold text-slate-500">èª­ã¿ã¨ã‚Š</button>
                </div>
                <button onclick="window.print()" class="bg-emerald-500 text-white px-6 py-2 rounded-xl font-bold shadow-lg hover:bg-emerald-600 transition">ğŸ–¨ï¸ å°åˆ·ã™ã‚‹</button>
            </div>
        </header>

        <div id="input-container" class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-8"></div>
        <button onclick="addQuestion()" class="w-full py-4 border-2 border-dashed border-slate-300 rounded-2xl text-slate-400 font-bold hover:bg-slate-50 transition">ï¼‹ æ–°ã—ã„å•é¡Œã‚’è¿½åŠ </button>
    </div>

    <div id="print-preview-container"></div>

    <script>
        let currentMode = 'write';
        // åˆæœŸçŠ¶æ…‹ã‚’å®Œå…¨ã«ç©ºã«è¨­å®š
        let questions = [{ text: '', reading: '', img: '' }];

        function setMode(mode) {
            currentMode = mode;
            document.getElementById('btn-write').className = mode === 'write' ? 'px-4 py-2 rounded-lg text-sm font-bold bg-white shadow-sm text-sky-600' : 'px-4 py-2 rounded-lg text-sm font-bold text-slate-500';
            document.getElementById('btn-read').className = mode === 'read' ? 'px-4 py-2 rounded-lg text-sm font-bold bg-white shadow-sm text-sky-600' : 'px-4 py-2 rounded-lg text-sm font-bold text-slate-500';
            renderPreview();
        }

        function addQuestion() {
            questions.push({ text: '', reading: '', img: '' });
            render();
        }

        function moveQuestion(index, direction) {
            const newIndex = index + direction;
            if (newIndex >= 0 && newIndex < questions.length) {
                [questions[index], questions[newIndex]] = [questions[newIndex], questions[index]];
                render();
            }
        }

        function updateData(index, key, value) {
            questions[index][key] = value;
            renderPreview();
        }

        function handleImage(index, input) {
            const file = input.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = (e) => {
                    questions[index].img = e.target.result;
                    render();
                };
                reader.readAsDataURL(file);
            }
        }

        function renderInputs() {
            const container = document.getElementById('input-container');
            container.innerHTML = '';
            questions.forEach((q, i) => {
                const div = document.createElement('div');
                div.className = 'bg-white p-4 rounded-xl border border-slate-200 shadow-sm space-y-3';
                div.innerHTML = `
                    <div class="flex justify-between items-center">
                        <div class="flex items-center gap-3">
                            <span class="text-xs font-bold text-slate-400">å•é¡Œ ${i + 1}</span>
                            <div class="reorder-btn no-print">
                                <button onclick="moveQuestion(${i}, -1)" ${i === 0 ? 'disabled' : ''}>â–²</button>
                                <button onclick="moveQuestion(${i}, 1)" ${i === questions.length - 1 ? 'disabled' : ''}>â–¼</button>
                            </div>
                        </div>
                        <button onclick="questions.splice(${i},1); render();" class="text-slate-300 hover:text-rose-400 font-bold px-2">âœ•</button>
                    </div>
                    <div class="flex gap-3">
                        <label class="w-16 h-16 bg-slate-100 rounded-lg flex-shrink-0 cursor-pointer overflow-hidden border-2 border-dashed border-slate-200 flex items-center justify-center hover:bg-slate-200">
                            ${q.img ? `<img src="${q.img}" class="w-full h-full object-cover">` : '<span class="text-[10px] text-slate-400 font-bold">ç”»åƒ</span>'}
                            <input type="file" accept="image/*" onchange="handleImage(${i}, this)" class="hidden">
                        </label>
                        <div class="flex-grow space-y-2">
                            <input type="text" placeholder="æ–‡ç« ï¼š[å±±]ã«ã®ã¼ã‚‹" oninput="updateData(${i}, 'text', this.value)" value="${q.text}" class="w-full p-1 border-b border-slate-200 outline-none text-sm font-bold">
                            <input type="text" placeholder="ãµã‚ŠãŒãª" oninput="updateData(${i}, 'reading', this.value)" value="${q.reading}" class="w-full p-1 border-b border-slate-200 outline-none text-xs text-sky-600">
                        </div>
                    </div>
                `;
                container.appendChild(div);
            });
        }

        function parseSentence(text, reading) {
            const regex = /\[(.*?)\]/;
            const match = text.match(regex);
            if (!match) return `<span>${text}</span>`;
            const parts = text.split(regex);
            if (currentMode === 'write') {
                return `<span>${parts[0]}</span><div class="write-box"><span class="ruby">${reading}</span></div><span>${parts[2]}</span>`;
            } else {
                return `<span>${parts[0]}</span><span class="read-underline">${match[1]}</span><span>${parts[2]}</span><div class="read-ans-line"></div>`;
            }
        }

        function renderPreview() {
            const container = document.getElementById('print-preview-container');
            container.innerHTML = '';
            for (let i = 0; i < questions.length; i += 10) {
                const chunk = questions.slice(i, i + 10);
                const page = document.createElement('div');
                page.className = 'print-page';
                page.innerHTML = `
                    <div class="print-header">
                        <div class="header-date"><span class="underline-box"></span> ãŒã¤ <span class="underline-box"></span> ã«ã¡</div>
                        <div class="header-name">ãªã¾ãˆ <span class="underline-box" style="min-width: 180px;"></span></div>
                    </div>
                    <div class="question-grid" id="grid-${i}"></div>
                `;
                container.appendChild(page);
                const grid = document.getElementById(`grid-${i}`);
                chunk.forEach((q, j) => {
                    const box = document.createElement('div');
                    box.className = 'question-box';
                    box.innerHTML = `
                        <div class="text-[10px] font-bold text-slate-300 w-4">${i + j + 1}</div>
                        <div class="img-preview-box">${q.img ? `<img src="${q.img}">` : ''}</div>
                        <div class="sentence-display">${parseSentence(q.text, q.reading)}</div>
                    `;
                    grid.appendChild(box);
                });
                // 10å•ã«æº€ãŸãªã„å ´åˆã®ç©ºæ 
                for (let k = chunk.length; k < 10; k++) {
                    const empty = document.createElement('div');
                    empty.className = 'question-box border-dashed opacity-20';
                    empty.innerHTML = `<div class="text-[10px] font-bold w-4">${i + k + 1}</div><div class="img-preview-box"></div>`;
                    grid.appendChild(empty);
                }
            }
        }

        function render() { renderInputs(); renderPreview(); }
        render();
    </script>
</body>
</html>